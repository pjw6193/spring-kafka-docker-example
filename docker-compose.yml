version: '2'
services:
  zookeeper:
    image: jplock/zookeeper:3.4.6
    container_name: zookeeper
    ports:
      - "2181:2181"
  kafka:
    image: wurstmeister/kafka:0.8.2.0
    container_name: kafka
    hostname: kafka
    links: 
     - zookeeper:zk
    depends_on: 
     - zookeeper
    environment:
      KAFKA_ADVERTISED_HOST_NAME: "localhost"
      KAFKA_ADVERTISED_PORT: 6543
      KAFKA_ZOOKEEPER_CONNECT: "zk:2181"
      KAFKA_CREATE_TOPICS: "CREATE_CUSTOMER:1:1"
    ports:
     - "6543:6543"
  mongodb:
    container_name: customer-datastore
    image: mongo:3.2
    command: mongod --smallfiles
  consumer:
    container_name: customer-service
    build: customer/target
    image: customer
    depends_on: 
      - mongodb
    ports:
      - "56789:56789"
    links:
      - mongodb
      - kafka
    environment:
      SPRING_DATA_MONGODB_URI: mongodb://mongodb/test
  web:
    container_name: example-service
    build: example/target
    image: example
    depends_on: 
      - mongodb
    ports:
      - "9999:9999"
    links:
      - mongodb
      - kafka
    environment:
      SPRING_DATA_MONGODB_URI: mongodb://mongodb/test